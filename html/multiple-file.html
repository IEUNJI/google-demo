<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiple File</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css">
  <style>
    html {
      overflow-y: auto;
    }

    .app-title {
      font-size: x-large;
      user-select: none;
    }

    .app-main-container {
      height: 100%;
    }
  </style>
</head>

<body>
  <div id="app">
    <v-app>
      <v-app-bar app dark clipped-left color="indigo">
        <v-toolbar-title>
          <h1 class="app-title">Multiple File</h1>
        </v-toolbar-title>
        <v-spacer></v-spacer>
      </v-app-bar>
      <v-navigation-drawer app dark clipped permanent width="400px" color="grey lighten-5">
        <v-container fluid>
          <v-btn dark block tile outlined color="indigo" :loading="btnLoading" @click="btnClickHandler">打开文件夹</v-btn>
        </v-container>
      </v-navigation-drawer>
      <v-main>
        <v-container fluid class="app-main-container">
          <v-card class="mx-auto" max-width="400" tile>
            <v-list-item v-for="(file, i) in fileArr" :key="i">
              <v-list-item-icon>
                <v-icon v-text="i + 1"></v-icon>
              </v-list-item-icon>
              <v-list-item-content>
                <v-list-item-title>{{ file.name }}</v-list-item-title>
                <v-list-item-subtitle>{{ getFileSize(file.size) }}</v-list-item-subtitle>
              </v-list-item-content>
            </v-list-item>
          </v-card>
        </v-container>
      </v-main>
      <v-footer app dark color="indigo" height="42px"></v-footer>
    </v-app>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.js"></script>
  <script>
    new Vue({
      el: '#app',
      vuetify: new Vuetify(),
      data: {
        btnLoading: false,
        fileArr: []
      },
      methods: {
        btnClickHandler() {
          this.fileArr = [];
          this.btnLoading = true;
          showDirectoryPicker()
            .then(handle => {
              this.findTargetFileFromHandle(handle);
            })
            .catch(() => {

            })
            .finally(() => {
              this.btnLoading = false;
            });
        },
        async findTargetFileFromHandle(handle) {
          for await (const h of handle.values()) {
            if (this.isDirectory(h)) {
              this.findTargetFileFromHandle(h);
            } else if (this.isFile(h) && this.isTarget(h)) {
              const file = await h.getFile();
              this.fileArr.push(file);
            }
          }
        },
        isDirectory(handle) {
          return handle.kind === 'directory';
        },
        isFile(handle) {
          return handle.kind === 'file';
        },
        isTarget(handle) {
          return handle.name.endsWith('.xlsx');
        },
        getFileSize(size) {
          if (size < 1024) {
            return `${size.toLocaleString()} B`;
          }
          if (size < 1024 * 1024) {
            return `${Math.floor(size / 1024).toLocaleString()} KB`;
          }
          return `${Math.floor(size / (1024 * 1024)).toLocaleString()} MB`;
        }
      }
    });
  </script>
</body>

</html>